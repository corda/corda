{"version":3,"file":"expression_converter.js","sourceRoot":"","sources":["../../../../../modules/@angular/compiler/src/view_compiler/expression_converter.ts"],"names":[],"mappings":"AAAA;;;;;;GAMG;;AAGH,2BAA4B,sBAAsB,CAAC,CAAA;AACnD,qBAA0C,gBAAgB,CAAC,CAAA;AAC3D,4BAA0B,gBAAgB,CAAC,CAAA;AAC3C,IAAY,CAAC,WAAM,sBAAsB,CAAC,CAAA;AAE1C,IAAI,iBAAiB,GAAG,CAAC,CAAC,QAAQ,CAAC,WAAW,CAAC,CAAC;AAShD;IACE,wCAAmB,UAAwB,EAAS,mBAA4B;QAA7D,eAAU,GAAV,UAAU,CAAc;QAAS,wBAAmB,GAAnB,mBAAmB,CAAS;IAAG,CAAC;IACtF,qCAAC;AAAD,CAAC,AAFD,IAEC;AAFY,sCAA8B,iCAE1C,CAAA;AAED,iCACI,YAA0B,EAAE,gBAA8B,EAAE,UAAqB,EACjF,cAA6B;IAC/B,IAAI,OAAO,GAAG,IAAI,eAAe,CAAC,YAAY,EAAE,gBAAgB,EAAE,cAAc,CAAC,CAAC;IAClF,IAAI,KAAK,GAAiB,UAAU,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;IACtE,MAAM,CAAC,IAAI,8BAA8B,CAAC,KAAK,EAAE,OAAO,CAAC,mBAAmB,CAAC,CAAC;AAChF,CAAC;AANe,+BAAuB,0BAMtC,CAAA;AAED,gCACI,YAA0B,EAAE,gBAA8B,EAAE,IAAe;IAC7E,IAAI,OAAO,GAAG,IAAI,eAAe,CAAC,YAAY,EAAE,gBAAgB,EAAE,IAAI,CAAC,CAAC;IACxE,IAAI,UAAU,GAA4B,EAAE,CAAC;IAC7C,iBAAiB,CAAC,IAAI,CAAC,KAAK,CAAC,OAAO,EAAE,KAAK,CAAC,SAAS,CAAC,EAAE,UAAU,CAAC,CAAC;IACpE,MAAM,CAAC,UAAU,CAAC;AACpB,CAAC;AANe,8BAAsB,yBAMrC,CAAA;AAED,IAAK,KAGJ;AAHD,WAAK,KAAK;IACR,2CAAS,CAAA;IACT,6CAAU,CAAA;AACZ,CAAC,EAHI,KAAK,KAAL,KAAK,QAGT;AAED,6BAA6B,IAAW,EAAE,GAAc;IACtD,EAAE,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QAC7B,MAAM,IAAI,0BAAa,CAAC,mCAAiC,GAAK,CAAC,CAAC;IAClE,CAAC;AACH,CAAC;AAED,8BAA8B,IAAW,EAAE,GAAc;IACvD,EAAE,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;QAC9B,MAAM,IAAI,0BAAa,CAAC,qCAAmC,GAAK,CAAC,CAAC;IACpE,CAAC;AACH,CAAC;AAED,oCAAoC,IAAW,EAAE,IAAkB;IACjE,EAAE,CAAC,CAAC,IAAI,KAAK,KAAK,CAAC,SAAS,CAAC,CAAC,CAAC;QAC7B,MAAM,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;IACvB,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;AACH,CAAC;AAED;IAGE,yBACY,aAA2B,EAAU,iBAA+B,EACpE,eAA8B;QAD9B,kBAAa,GAAb,aAAa,CAAc;QAAU,sBAAiB,GAAjB,iBAAiB,CAAc;QACpE,oBAAe,GAAf,eAAe,CAAe;QAJnC,wBAAmB,GAAY,KAAK,CAAC;IAIC,CAAC;IAE9C,qCAAW,GAAX,UAAY,GAAiB,EAAE,IAAW;QACxC,IAAI,EAAO,CAAmB;QAC9B,MAAM,CAAC,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC,CAAC;YACtB,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,IAAI,CAAC;gBAC3B,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC;gBAC5B,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,QAAQ,CAAC;gBAC/B,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC;gBAC7B,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC;gBAC7B,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,GAAG,CAAC;gBAC1B,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,EAAE,CAAC;gBACzB,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC;gBAC7B,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC;gBAChC,KAAK,CAAC;YACR,KAAK,KAAK;gBACR,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,SAAS,CAAC;gBAChC,KAAK,CAAC;YACR,KAAK,KAAK;gBACR,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,YAAY,CAAC;gBACnC,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,KAAK,CAAC;gBAC5B,KAAK,CAAC;YACR,KAAK,GAAG;gBACN,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,MAAM,CAAC;gBAC7B,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,WAAW,CAAC;gBAClC,KAAK,CAAC;YACR,KAAK,IAAI;gBACP,EAAE,GAAG,CAAC,CAAC,cAAc,CAAC,YAAY,CAAC;gBACnC,KAAK,CAAC;YACR;gBACE,MAAM,IAAI,0BAAa,CAAC,2BAAyB,GAAG,CAAC,SAAW,CAAC,CAAC;QACtE,CAAC;QAED,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EACJ,IAAI,CAAC,CAAC,kBAAkB,CACpB,EAAE,EAAE,GAAG,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAChG,CAAC;IACD,oCAAU,GAAV,UAAW,GAAgB,EAAE,IAAW;QACtC,mBAAmB,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAC/B,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC;IAC9C,CAAC;IACD,0CAAgB,GAAhB,UAAiB,GAAsB,EAAE,IAAW;QAClD,IAAI,KAAK,GAAiB,GAAG,CAAC,SAAS,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QACtE,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EACJ,KAAK,CAAC,WAAW,CACb,GAAG,CAAC,OAAO,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,EAAE,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAClG,CAAC;IACD,mCAAS,GAAT,UAAU,GAAsB,EAAE,IAAW;QAC3C,IAAI,KAAK,GAAG,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAClD,IAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QACrD,IAAI,KAAK,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;QAC/D,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;QAChC,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,IAAI,CAAC,eAAe,CAAC,UAAU,CAAC,QAAQ,EAAE,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC;IAC9F,CAAC;IACD,2CAAiB,GAAjB,UAAkB,GAAuB,EAAE,IAAW;QACpD,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EACJ,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAClG,CAAC;IACD,+CAAqB,GAArB,UAAsB,GAA2B,EAAE,IAAW;QAC5D,oBAAoB,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAChC,MAAM,CAAC,iBAAiB,CAAC;IAC3B,CAAC;IACD,4CAAkB,GAAlB,UAAmB,GAAwB,EAAE,IAAW;QACtD,oBAAoB,CAAC,IAAI,EAAE,GAAG,CAAC,CAAC;QAChC,IAAI,IAAI,GAAG,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,WAAW,CAAC,MAAM,CAAC,CAAC,CAAC;QAC/C,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE,CAAC;YAChD,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;YACrC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,WAAW,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC;QAC9D,CAAC;QACD,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC,CAAC,CAAC;QAC1D,MAAM,CAAC,CAAC,CAAC,UAAU,CAAC,yBAAW,CAAC,WAAW,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;IAC5D,CAAC;IACD,wCAAc,GAAd,UAAe,GAAoB,EAAE,IAAW;QAC9C,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAC9F,CAAC;IACD,yCAAe,GAAf,UAAgB,GAAqB,EAAE,IAAW;QAChD,IAAI,GAAG,GAAiB,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC9D,IAAI,GAAG,GAAiB,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC9D,IAAI,KAAK,GAAiB,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAClE,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,GAAG,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;IACnE,CAAC;IACD,2CAAiB,GAAjB,UAAkB,GAAuB,EAAE,IAAW;QACpD,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,kBAAkB,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;IACzF,CAAC;IACD,yCAAe,GAAf,UAAgB,GAAqB,EAAE,IAAW;QAChD,IAAI,KAAK,GAA4B,EAAE,CAAC;QACxC,GAAG,CAAC,CAAC,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE,CAAC;YACzC,KAAK,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACzE,CAAC;QACD,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,KAAK,CAAC,CAAC,CAAC;IACtF,CAAC;IACD,+CAAqB,GAArB,UAAsB,GAA2B,EAAE,IAAW;QAC5D,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC,CAAC;IAChE,CAAC;IACD,yCAAe,GAAf,UAAgB,GAAqB,EAAE,IAAW;QAChD,IAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QACrD,IAAI,MAAM,GAA0B,IAAI,CAAC;QACzC,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC1D,EAAE,CAAC,CAAC,QAAQ,KAAK,iBAAiB,CAAC,CAAC,CAAC;YACnC,IAAI,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACpD,EAAE,CAAC,CAAC,gBAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACvB,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAChC,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,QAAQ,GAAG,IAAI,CAAC,iBAAiB,CAAC;YACpC,CAAC;QACH,CAAC;QACD,EAAE,CAAC,CAAC,cAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACpB,MAAM,GAAG,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QAC/C,CAAC;QACD,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAClD,CAAC;IACD,wCAAc,GAAd,UAAe,GAAoB,EAAE,IAAW;QAC9C,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,UAAU,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAC/F,CAAC;IACD,2CAAiB,GAAjB,UAAkB,GAAuB,EAAE,IAAW;QACpD,IAAI,MAAM,GAA0B,IAAI,CAAC;QACzC,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC1D,EAAE,CAAC,CAAC,QAAQ,KAAK,iBAAiB,CAAC,CAAC,CAAC;YACnC,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YAC/C,EAAE,CAAC,CAAC,cAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBACpB,QAAQ,GAAG,IAAI,CAAC,iBAAiB,CAAC;YACpC,CAAC;QACH,CAAC;QACD,EAAE,CAAC,CAAC,cAAO,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACpB,MAAM,GAAG,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;QACnC,CAAC;QACD,MAAM,CAAC,0BAA0B,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;IAClD,CAAC;IACD,4CAAkB,GAAlB,UAAmB,GAAwB,EAAE,IAAW;QACtD,IAAI,QAAQ,GAAiB,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QACxE,EAAE,CAAC,CAAC,QAAQ,KAAK,iBAAiB,CAAC,CAAC,CAAC;YACnC,IAAI,OAAO,GAAG,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACpD,EAAE,CAAC,CAAC,gBAAS,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;gBACvB,MAAM,IAAI,0BAAa,CAAC,2CAA2C,CAAC,CAAC;YACvE,CAAC;YACD,QAAQ,GAAG,IAAI,CAAC,iBAAiB,CAAC;QACpC,CAAC;QACD,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,GAAG,CAAC,GAAG,CAAC,KAAK,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC;IACD,+CAAqB,GAArB,UAAsB,GAA2B,EAAE,IAAW;QAC5D,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC1D,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EAAE,QAAQ,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,SAAS,EAAE,QAAQ,CAAC,IAAI,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;IAClF,CAAC;IACD,6CAAmB,GAAnB,UAAoB,GAAyB,EAAE,IAAW;QACxD,IAAI,QAAQ,GAAG,GAAG,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QAC1D,IAAI,IAAI,GAAG,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,UAAU,CAAC,CAAC;QACrD,MAAM,CAAC,0BAA0B,CAC7B,IAAI,EAAE,QAAQ,CAAC,OAAO,EAAE,CAAC,WAAW,CAAC,CAAC,CAAC,SAAS,EAAE,QAAQ,CAAC,UAAU,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC;IAC9F,CAAC;IACD,kCAAQ,GAAR,UAAS,IAAiB,EAAE,IAAW;QAAvC,iBAAgG;QAAhD,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,UAAA,GAAG,IAAI,OAAA,GAAG,CAAC,KAAK,CAAC,KAAI,EAAE,IAAI,CAAC,EAArB,CAAqB,CAAC,CAAC;IAAC,CAAC;IAChG,oCAAU,GAAV,UAAW,GAAgB,EAAE,IAAW;QACtC,MAAM,IAAI,0BAAa,CAAC,0CAA0C,CAAC,CAAC;IACtE,CAAC;IACH,sBAAC;AAAD,CAAC,AA1LD,IA0LC;AAED,2BAA2B,GAAQ,EAAE,MAAqB;IACxD,EAAE,CAAC,CAAC,cAAO,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;QACT,GAAI,CAAC,OAAO,CAAC,UAAC,KAAK,IAAK,OAAA,iBAAiB,CAAC,KAAK,EAAE,MAAM,CAAC,EAAhC,CAAgC,CAAC,CAAC;IACpE,CAAC;IAAC,IAAI,CAAC,CAAC;QACN,MAAM,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;IACnB,CAAC;AACH,CAAC","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport * as cdAst from '../expression_parser/ast';\nimport {BaseException} from '../facade/exceptions';\nimport {isArray, isBlank, isPresent} from '../facade/lang';\nimport {Identifiers} from '../identifiers';\nimport * as o from '../output/output_ast';\n\nvar IMPLICIT_RECEIVER = o.variable('#implicit');\n\nexport interface NameResolver {\n  callPipe(name: string, input: o.Expression, args: o.Expression[]): o.Expression;\n  getLocal(name: string): o.Expression;\n  createLiteralArray(values: o.Expression[]): o.Expression;\n  createLiteralMap(values: Array<Array<string|o.Expression>>): o.Expression;\n}\n\nexport class ExpressionWithWrappedValueInfo {\n  constructor(public expression: o.Expression, public needsValueUnwrapper: boolean) {}\n}\n\nexport function convertCdExpressionToIr(\n    nameResolver: NameResolver, implicitReceiver: o.Expression, expression: cdAst.AST,\n    valueUnwrapper: o.ReadVarExpr): ExpressionWithWrappedValueInfo {\n  var visitor = new _AstToIrVisitor(nameResolver, implicitReceiver, valueUnwrapper);\n  var irAst: o.Expression = expression.visit(visitor, _Mode.Expression);\n  return new ExpressionWithWrappedValueInfo(irAst, visitor.needsValueUnwrapper);\n}\n\nexport function convertCdStatementToIr(\n    nameResolver: NameResolver, implicitReceiver: o.Expression, stmt: cdAst.AST): o.Statement[] {\n  var visitor = new _AstToIrVisitor(nameResolver, implicitReceiver, null);\n  var statements: any[] /** TODO #9100 */ = [];\n  flattenStatements(stmt.visit(visitor, _Mode.Statement), statements);\n  return statements;\n}\n\nenum _Mode {\n  Statement,\n  Expression\n}\n\nfunction ensureStatementMode(mode: _Mode, ast: cdAst.AST) {\n  if (mode !== _Mode.Statement) {\n    throw new BaseException(`Expected a statement, but saw ${ast}`);\n  }\n}\n\nfunction ensureExpressionMode(mode: _Mode, ast: cdAst.AST) {\n  if (mode !== _Mode.Expression) {\n    throw new BaseException(`Expected an expression, but saw ${ast}`);\n  }\n}\n\nfunction convertToStatementIfNeeded(mode: _Mode, expr: o.Expression): o.Expression|o.Statement {\n  if (mode === _Mode.Statement) {\n    return expr.toStmt();\n  } else {\n    return expr;\n  }\n}\n\nclass _AstToIrVisitor implements cdAst.AstVisitor {\n  public needsValueUnwrapper: boolean = false;\n\n  constructor(\n      private _nameResolver: NameResolver, private _implicitReceiver: o.Expression,\n      private _valueUnwrapper: o.ReadVarExpr) {}\n\n  visitBinary(ast: cdAst.Binary, mode: _Mode): any {\n    var op: any /** TODO #9100 */;\n    switch (ast.operation) {\n      case '+':\n        op = o.BinaryOperator.Plus;\n        break;\n      case '-':\n        op = o.BinaryOperator.Minus;\n        break;\n      case '*':\n        op = o.BinaryOperator.Multiply;\n        break;\n      case '/':\n        op = o.BinaryOperator.Divide;\n        break;\n      case '%':\n        op = o.BinaryOperator.Modulo;\n        break;\n      case '&&':\n        op = o.BinaryOperator.And;\n        break;\n      case '||':\n        op = o.BinaryOperator.Or;\n        break;\n      case '==':\n        op = o.BinaryOperator.Equals;\n        break;\n      case '!=':\n        op = o.BinaryOperator.NotEquals;\n        break;\n      case '===':\n        op = o.BinaryOperator.Identical;\n        break;\n      case '!==':\n        op = o.BinaryOperator.NotIdentical;\n        break;\n      case '<':\n        op = o.BinaryOperator.Lower;\n        break;\n      case '>':\n        op = o.BinaryOperator.Bigger;\n        break;\n      case '<=':\n        op = o.BinaryOperator.LowerEquals;\n        break;\n      case '>=':\n        op = o.BinaryOperator.BiggerEquals;\n        break;\n      default:\n        throw new BaseException(`Unsupported operation ${ast.operation}`);\n    }\n\n    return convertToStatementIfNeeded(\n        mode,\n        new o.BinaryOperatorExpr(\n            op, ast.left.visit(this, _Mode.Expression), ast.right.visit(this, _Mode.Expression)));\n  }\n  visitChain(ast: cdAst.Chain, mode: _Mode): any {\n    ensureStatementMode(mode, ast);\n    return this.visitAll(ast.expressions, mode);\n  }\n  visitConditional(ast: cdAst.Conditional, mode: _Mode): any {\n    var value: o.Expression = ast.condition.visit(this, _Mode.Expression);\n    return convertToStatementIfNeeded(\n        mode,\n        value.conditional(\n            ast.trueExp.visit(this, _Mode.Expression), ast.falseExp.visit(this, _Mode.Expression)));\n  }\n  visitPipe(ast: cdAst.BindingPipe, mode: _Mode): any {\n    var input = ast.exp.visit(this, _Mode.Expression);\n    var args = this.visitAll(ast.args, _Mode.Expression);\n    var value = this._nameResolver.callPipe(ast.name, input, args);\n    this.needsValueUnwrapper = true;\n    return convertToStatementIfNeeded(mode, this._valueUnwrapper.callMethod('unwrap', [value]));\n  }\n  visitFunctionCall(ast: cdAst.FunctionCall, mode: _Mode): any {\n    return convertToStatementIfNeeded(\n        mode,\n        ast.target.visit(this, _Mode.Expression).callFn(this.visitAll(ast.args, _Mode.Expression)));\n  }\n  visitImplicitReceiver(ast: cdAst.ImplicitReceiver, mode: _Mode): any {\n    ensureExpressionMode(mode, ast);\n    return IMPLICIT_RECEIVER;\n  }\n  visitInterpolation(ast: cdAst.Interpolation, mode: _Mode): any {\n    ensureExpressionMode(mode, ast);\n    var args = [o.literal(ast.expressions.length)];\n    for (var i = 0; i < ast.strings.length - 1; i++) {\n      args.push(o.literal(ast.strings[i]));\n      args.push(ast.expressions[i].visit(this, _Mode.Expression));\n    }\n    args.push(o.literal(ast.strings[ast.strings.length - 1]));\n    return o.importExpr(Identifiers.interpolate).callFn(args);\n  }\n  visitKeyedRead(ast: cdAst.KeyedRead, mode: _Mode): any {\n    return convertToStatementIfNeeded(\n        mode, ast.obj.visit(this, _Mode.Expression).key(ast.key.visit(this, _Mode.Expression)));\n  }\n  visitKeyedWrite(ast: cdAst.KeyedWrite, mode: _Mode): any {\n    var obj: o.Expression = ast.obj.visit(this, _Mode.Expression);\n    var key: o.Expression = ast.key.visit(this, _Mode.Expression);\n    var value: o.Expression = ast.value.visit(this, _Mode.Expression);\n    return convertToStatementIfNeeded(mode, obj.key(key).set(value));\n  }\n  visitLiteralArray(ast: cdAst.LiteralArray, mode: _Mode): any {\n    return convertToStatementIfNeeded(\n        mode, this._nameResolver.createLiteralArray(this.visitAll(ast.expressions, mode)));\n  }\n  visitLiteralMap(ast: cdAst.LiteralMap, mode: _Mode): any {\n    var parts: any[] /** TODO #9100 */ = [];\n    for (var i = 0; i < ast.keys.length; i++) {\n      parts.push([ast.keys[i], ast.values[i].visit(this, _Mode.Expression)]);\n    }\n    return convertToStatementIfNeeded(mode, this._nameResolver.createLiteralMap(parts));\n  }\n  visitLiteralPrimitive(ast: cdAst.LiteralPrimitive, mode: _Mode): any {\n    return convertToStatementIfNeeded(mode, o.literal(ast.value));\n  }\n  visitMethodCall(ast: cdAst.MethodCall, mode: _Mode): any {\n    var args = this.visitAll(ast.args, _Mode.Expression);\n    var result: any /** TODO #9100 */ = null;\n    var receiver = ast.receiver.visit(this, _Mode.Expression);\n    if (receiver === IMPLICIT_RECEIVER) {\n      var varExpr = this._nameResolver.getLocal(ast.name);\n      if (isPresent(varExpr)) {\n        result = varExpr.callFn(args);\n      } else {\n        receiver = this._implicitReceiver;\n      }\n    }\n    if (isBlank(result)) {\n      result = receiver.callMethod(ast.name, args);\n    }\n    return convertToStatementIfNeeded(mode, result);\n  }\n  visitPrefixNot(ast: cdAst.PrefixNot, mode: _Mode): any {\n    return convertToStatementIfNeeded(mode, o.not(ast.expression.visit(this, _Mode.Expression)));\n  }\n  visitPropertyRead(ast: cdAst.PropertyRead, mode: _Mode): any {\n    var result: any /** TODO #9100 */ = null;\n    var receiver = ast.receiver.visit(this, _Mode.Expression);\n    if (receiver === IMPLICIT_RECEIVER) {\n      result = this._nameResolver.getLocal(ast.name);\n      if (isBlank(result)) {\n        receiver = this._implicitReceiver;\n      }\n    }\n    if (isBlank(result)) {\n      result = receiver.prop(ast.name);\n    }\n    return convertToStatementIfNeeded(mode, result);\n  }\n  visitPropertyWrite(ast: cdAst.PropertyWrite, mode: _Mode): any {\n    var receiver: o.Expression = ast.receiver.visit(this, _Mode.Expression);\n    if (receiver === IMPLICIT_RECEIVER) {\n      var varExpr = this._nameResolver.getLocal(ast.name);\n      if (isPresent(varExpr)) {\n        throw new BaseException('Cannot assign to a reference or variable!');\n      }\n      receiver = this._implicitReceiver;\n    }\n    return convertToStatementIfNeeded(\n        mode, receiver.prop(ast.name).set(ast.value.visit(this, _Mode.Expression)));\n  }\n  visitSafePropertyRead(ast: cdAst.SafePropertyRead, mode: _Mode): any {\n    var receiver = ast.receiver.visit(this, _Mode.Expression);\n    return convertToStatementIfNeeded(\n        mode, receiver.isBlank().conditional(o.NULL_EXPR, receiver.prop(ast.name)));\n  }\n  visitSafeMethodCall(ast: cdAst.SafeMethodCall, mode: _Mode): any {\n    var receiver = ast.receiver.visit(this, _Mode.Expression);\n    var args = this.visitAll(ast.args, _Mode.Expression);\n    return convertToStatementIfNeeded(\n        mode, receiver.isBlank().conditional(o.NULL_EXPR, receiver.callMethod(ast.name, args)));\n  }\n  visitAll(asts: cdAst.AST[], mode: _Mode): any { return asts.map(ast => ast.visit(this, mode)); }\n  visitQuote(ast: cdAst.Quote, mode: _Mode): any {\n    throw new BaseException('Quotes are not supported for evaluation!');\n  }\n}\n\nfunction flattenStatements(arg: any, output: o.Statement[]) {\n  if (isArray(arg)) {\n    (<any[]>arg).forEach((entry) => flattenStatements(entry, output));\n  } else {\n    output.push(arg);\n  }\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}