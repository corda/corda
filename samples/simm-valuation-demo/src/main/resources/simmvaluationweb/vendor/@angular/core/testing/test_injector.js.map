{"version":3,"file":"test_injector.js","sourceRoot":"","sources":["../../../../modules/@angular/core/testing/test_injector.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport {PLATFORM_INITIALIZER, Provider, ReflectiveInjector, Type} from '../index';\nimport {lockRunMode} from '../src/application_ref';\nimport {ListWrapper} from '../src/facade/collection';\nimport {BaseException} from '../src/facade/exceptions';\nimport {FunctionWrapper, isPresent} from '../src/facade/lang';\nimport {AsyncTestCompleter} from './async_test_completer';\n\n/**\n * @experimental\n */\nexport class TestInjector {\n  private _instantiated: boolean = false;\n\n  private _injector: ReflectiveInjector = null;\n\n  private _providers: Array<Type|Provider|any[]|any> = [];\n\n  reset() {\n    this._injector = null;\n    this._providers = [];\n    this._instantiated = false;\n  }\n\n  platformProviders: Array<Type|Provider|any[]|any> = [];\n\n  applicationProviders: Array<Type|Provider|any[]|any> = [];\n\n  addProviders(providers: Array<Type|Provider|any[]|any>) {\n    if (this._instantiated) {\n      throw new BaseException('Cannot add providers after test injector is instantiated');\n    }\n    this._providers = ListWrapper.concat(this._providers, providers);\n  }\n\n  createInjector() {\n    lockRunMode();\n    var rootInjector = ReflectiveInjector.resolveAndCreate(this.platformProviders);\n    this._injector = rootInjector.resolveAndCreateChild(\n        ListWrapper.concat(this.applicationProviders, this._providers));\n    this._instantiated = true;\n    return this._injector;\n  }\n\n  get(token: any) {\n    if (!this._instantiated) {\n      this.createInjector();\n    }\n    return this._injector.get(token);\n  }\n\n  execute(tokens: any[], fn: Function): any {\n    if (!this._instantiated) {\n      this.createInjector();\n    }\n    var params = tokens.map(t => this._injector.get(t));\n    return FunctionWrapper.apply(fn, params);\n  }\n}\n\nvar _testInjector: TestInjector = null;\n\n/**\n * @experimental\n */\nexport function getTestInjector() {\n  if (_testInjector == null) {\n    _testInjector = new TestInjector();\n  }\n  return _testInjector;\n}\n\n/**\n * Set the providers that the test injector should use. These should be providers\n * common to every test in the suite.\n *\n * This may only be called once, to set up the common providers for the current test\n * suite on the current platform. If you absolutely need to change the providers,\n * first use `resetBaseTestProviders`.\n *\n * Test Providers for individual platforms are available from\n * 'angular2/platform/testing/<platform_name>'.\n *\n * @experimental\n */\nexport function setBaseTestProviders(\n    platformProviders: Array<Type|Provider|any[]>,\n    applicationProviders: Array<Type|Provider|any[]>) {\n  var testInjector = getTestInjector();\n  if (testInjector.platformProviders.length > 0 || testInjector.applicationProviders.length > 0) {\n    throw new BaseException('Cannot set base providers because it has already been called');\n  }\n  testInjector.platformProviders = platformProviders;\n  testInjector.applicationProviders = applicationProviders;\n  var injector = testInjector.createInjector();\n  let inits: Function[] = injector.get(PLATFORM_INITIALIZER, null);\n  if (isPresent(inits)) {\n    inits.forEach(init => init());\n  }\n  testInjector.reset();\n}\n\n/**\n * Reset the providers for the test injector.\n *\n * @experimental\n */\nexport function resetBaseTestProviders() {\n  var testInjector = getTestInjector();\n  testInjector.platformProviders = [];\n  testInjector.applicationProviders = [];\n  testInjector.reset();\n}\n\n/**\n * Allows injecting dependencies in `beforeEach()` and `it()`.\n *\n * Example:\n *\n * ```\n * beforeEach(inject([Dependency, AClass], (dep, object) => {\n *   // some code that uses `dep` and `object`\n *   // ...\n * }));\n *\n * it('...', inject([AClass], (object) => {\n *   object.doSomething();\n *   expect(...);\n * })\n * ```\n *\n * Notes:\n * - inject is currently a function because of some Traceur limitation the syntax should\n * eventually\n *   becomes `it('...', @Inject (object: AClass, async: AsyncTestCompleter) => { ... });`\n *\n * @stable\n */\nexport function inject(tokens: any[], fn: Function): () => any {\n  let testInjector = getTestInjector();\n  if (tokens.indexOf(AsyncTestCompleter) >= 0) {\n    // Return an async test method that returns a Promise if AsyncTestCompleter is one of the\n    // injected tokens.\n    return () => {\n      let completer: AsyncTestCompleter = testInjector.get(AsyncTestCompleter);\n      testInjector.execute(tokens, fn);\n      return completer.promise;\n    };\n  } else {\n    // Return a synchronous test method with the injected tokens.\n    return () => { return getTestInjector().execute(tokens, fn); };\n  }\n}\n\n/**\n * @experimental\n */\nexport class InjectSetupWrapper {\n  constructor(private _providers: () => any) {}\n\n  private _addProviders() {\n    var additionalProviders = this._providers();\n    if (additionalProviders.length > 0) {\n      getTestInjector().addProviders(additionalProviders);\n    }\n  }\n\n  inject(tokens: any[], fn: Function): () => any {\n    return () => {\n      this._addProviders();\n      return inject_impl(tokens, fn)();\n    };\n  }\n}\n\n/**\n * @experimental\n */\nexport function withProviders(providers: () => any) {\n  return new InjectSetupWrapper(providers);\n}\n\n// This is to ensure inject(Async) within InjectSetupWrapper doesn't call itself\n// when transpiled to Dart.\nvar inject_impl = inject;\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}