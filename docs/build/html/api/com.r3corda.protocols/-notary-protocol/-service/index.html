<HTML>
<HEAD>
<title>NotaryProtocol.Service - </title>
<link rel="stylesheet" href="../../../style.css">
</HEAD>
<BODY>
<a href="../../index.html">com.r3corda.protocols</a>&nbsp;/&nbsp;<a href="../index.html">NotaryProtocol</a>&nbsp;/&nbsp;<a href=".">Service</a><br/>
<br/>
<h1>Service</h1>
<code><span class="keyword">class </span><span class="identifier">Service</span>&nbsp;<span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">Unit</span><span class="symbol">&gt;</span></code><br/>
<p>Checks that the timestamp command is valid (if present) and commits the input state, or returns a conflict
if any of the input states have been previously committed.</p>
<p>Extend this class, overriding <emph>beforeCommit</emph> to add custom transaction processing/validation logic.</p>
<p>TODO: the notary service should only be able to see timestamp commands and inputs</p>
<br/>
<br/>
<br/>
<br/>
<h3>Constructors</h3>
<table>
<tbody>
<tr>
<td>
<a href="-init-.html">&lt;init&gt;</a></td>
<td>
<code><span class="identifier">Service</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$<init>(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, com.r3corda.core.node.services.TimestampChecker, com.r3corda.core.node.services.UniquenessProvider)/otherSide">otherSide</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.crypto/-party/index.html"><span class="identifier">Party</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$<init>(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, com.r3corda.core.node.services.TimestampChecker, com.r3corda.core.node.services.UniquenessProvider)/sendSessionID">sendSessionID</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$<init>(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, com.r3corda.core.node.services.TimestampChecker, com.r3corda.core.node.services.UniquenessProvider)/receiveSessionID">receiveSessionID</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$<init>(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, com.r3corda.core.node.services.TimestampChecker, com.r3corda.core.node.services.UniquenessProvider)/timestampChecker">timestampChecker</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.node.services/-timestamp-checker/index.html"><span class="identifier">TimestampChecker</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$<init>(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, com.r3corda.core.node.services.TimestampChecker, com.r3corda.core.node.services.UniquenessProvider)/uniquenessProvider">uniquenessProvider</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.node.services/-uniqueness-provider/index.html"><span class="identifier">UniquenessProvider</span></a><span class="symbol">)</span></code><p>Checks that the timestamp command is valid (if present) and commits the input state, or returns a conflict
if any of the input states have been previously committed.</p>
</td>
</tr>
</tbody>
</table>
<h3>Properties</h3>
<table>
<tbody>
<tr>
<td>
<a href="other-side.html">otherSide</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">otherSide</span><span class="symbol">: </span><a href="../../../com.r3corda.core.crypto/-party/index.html"><span class="identifier">Party</span></a></code></td>
</tr>
<tr>
<td>
<a href="receive-session-i-d.html">receiveSessionID</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">receiveSessionID</span><span class="symbol">: </span><span class="identifier">Long</span></code></td>
</tr>
<tr>
<td>
<a href="send-session-i-d.html">sendSessionID</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">sendSessionID</span><span class="symbol">: </span><span class="identifier">Long</span></code></td>
</tr>
<tr>
<td>
<a href="timestamp-checker.html">timestampChecker</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">timestampChecker</span><span class="symbol">: </span><a href="../../../com.r3corda.core.node.services/-timestamp-checker/index.html"><span class="identifier">TimestampChecker</span></a></code></td>
</tr>
<tr>
<td>
<a href="topic.html">topic</a></td>
<td>
<code><span class="keyword">open</span> <span class="keyword">val </span><span class="identifier">topic</span><span class="symbol">: </span><span class="identifier">String</span></code><p>The topic to use when communicating with other parties. If more than one topic is required then use sub-protocols.
Note that this is temporary until protocol sessions are properly implemented.</p>
</td>
</tr>
<tr>
<td>
<a href="uniqueness-provider.html">uniquenessProvider</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">uniquenessProvider</span><span class="symbol">: </span><a href="../../../com.r3corda.core.node.services/-uniqueness-provider/index.html"><span class="identifier">UniquenessProvider</span></a></code></td>
</tr>
</tbody>
</table>
<h3>Inherited Properties</h3>
<table>
<tbody>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/logger.html">logger</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">logger</span><span class="symbol">: </span><span class="identifier">&lt;ERROR CLASS&gt;</span></code><p>This is where you should log things to.</p>
</td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/progress-tracker.html">progressTracker</a></td>
<td>
<code><span class="keyword">open</span> <span class="keyword">val </span><span class="identifier">progressTracker</span><span class="symbol">: </span><a href="../../../com.r3corda.core.utilities/-progress-tracker/index.html"><span class="identifier">ProgressTracker</span></a><span class="symbol">?</span></code><p>Override this to provide a <a href="../../../com.r3corda.core.utilities/-progress-tracker/index.html">ProgressTracker</a>. If one is provided and stepped, the framework will do something
helpful with the progress reports. If this protocol is invoked as a sub-protocol of another, then the
tracker will be made a child of the current step in the parent. If its null, this protocol doesnt track
progress.</p>
</td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/psm.html">psm</a></td>
<td>
<code><span class="keyword">lateinit</span> <span class="keyword">var </span><span class="identifier">psm</span><span class="symbol">: </span><a href="../../../com.r3corda.core.protocols/-protocol-state-machine/index.html"><span class="identifier">ProtocolStateMachine</span></a><span class="symbol">&lt;</span><span class="identifier">*</span><span class="symbol">&gt;</span></code><p>Reference to the <a href="#">Fiber</a> instance that is the top level controller for the entire flow.</p>
</td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/service-hub.html">serviceHub</a></td>
<td>
<code><span class="keyword">val </span><span class="identifier">serviceHub</span><span class="symbol">: </span><a href="../../../com.r3corda.core.node/-service-hub/index.html"><span class="identifier">ServiceHub</span></a></code><p>Provides access to big, heavy classes that may be reconstructed from time to time, e.g. across restarts. It is
only available once the protocol has started, which means it cannnot be accessed in the constructor. Either
access this lazily or from inside <a href="../../../com.r3corda.core.protocols/-protocol-logic/call.html">call</a>.</p>
</td>
</tr>
</tbody>
</table>
<h3>Functions</h3>
<table>
<tbody>
<tr>
<td>
<a href="before-commit.html">beforeCommit</a></td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">beforeCommit</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$beforeCommit(com.r3corda.core.contracts.SignedTransaction, com.r3corda.core.crypto.Party)/stx">stx</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.contracts/-signed-transaction/index.html"><span class="identifier">SignedTransaction</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.protocols.NotaryProtocol.Service$beforeCommit(com.r3corda.core.contracts.SignedTransaction, com.r3corda.core.crypto.Party)/reqIdentity">reqIdentity</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.crypto/-party/index.html"><span class="identifier">Party</span></a><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">Unit</span></code><p>No pre-commit processing is done. Transaction is not checked for contract-validity, as that would require fully
resolving it into a <a href="#">TransactionForVerification</a>, for which the caller would have to reveal the whole transaction
history chain.
As a result, the Notary <emph>will commit invalid transactions</emph> as well, but as it also records the identity of
the caller, it is possible to raise a dispute and verify the validity of the transaction and subsequently
undo the commit of the input states (the exact mechanism still needs to be worked out).</p>
</td>
</tr>
<tr>
<td>
<a href="call.html">call</a></td>
<td>
<code><span class="keyword">open</span> <span class="keyword">fun </span><span class="identifier">call</span><span class="symbol">(</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">Unit</span></code><p>This is where you fill out your business logic.</p>
</td>
</tr>
</tbody>
</table>
<h3>Inherited Functions</h3>
<table>
<tbody>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/receive.html">receive</a></td>
<td>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span>&nbsp;<span class="symbol">:</span>&nbsp;<span class="identifier">Any</span><span class="symbol">&gt;</span> <span class="identifier">receive</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$receive(kotlin.Long)/sessionIDForReceive">sessionIDForReceive</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">)</span><span class="symbol">: </span><a href="../../../com.r3corda.core.utilities/-untrustworthy-data/index.html"><span class="identifier">UntrustworthyData</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span></code><br/>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span>&nbsp;<span class="symbol">:</span>&nbsp;<span class="identifier">Any</span><span class="symbol">&gt;</span> <span class="identifier">receive</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$receive(kotlin.Long, java.lang.Class((com.r3corda.core.protocols.ProtocolLogic.receive.T)))/sessionIDForReceive">sessionIDForReceive</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$receive(kotlin.Long, java.lang.Class((com.r3corda.core.protocols.ProtocolLogic.receive.T)))/receiveType">receiveType</span><span class="symbol">:</span>&nbsp;<a href="http://docs.oracle.com/javase/6/docs/api/java/lang/Class.html"><span class="identifier">Class</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><a href="../../../com.r3corda.core.utilities/-untrustworthy-data/index.html"><span class="identifier">UntrustworthyData</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/send.html">send</a></td>
<td>
<code><span class="keyword">fun </span><span class="identifier">send</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$send(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Any)/destination">destination</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.crypto/-party/index.html"><span class="identifier">Party</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$send(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Any)/sessionID">sessionID</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$send(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Any)/payload">payload</span><span class="symbol">:</span>&nbsp;<span class="identifier">Any</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">Unit</span></code></td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/send-and-receive.html">sendAndReceive</a></td>
<td>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">T</span>&nbsp;<span class="symbol">:</span>&nbsp;<span class="identifier">Any</span><span class="symbol">&gt;</span> <span class="identifier">sendAndReceive</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$sendAndReceive(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, kotlin.Any)/destination">destination</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.crypto/-party/index.html"><span class="identifier">Party</span></a><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$sendAndReceive(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, kotlin.Any)/sessionIDForSend">sessionIDForSend</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$sendAndReceive(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, kotlin.Any)/sessionIDForReceive">sessionIDForReceive</span><span class="symbol">:</span>&nbsp;<span class="identifier">Long</span><span class="symbol">, </span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$sendAndReceive(com.r3corda.core.crypto.Party, kotlin.Long, kotlin.Long, kotlin.Any)/payload">payload</span><span class="symbol">:</span>&nbsp;<span class="identifier">Any</span><span class="symbol">)</span><span class="symbol">: </span><a href="../../../com.r3corda.core.utilities/-untrustworthy-data/index.html"><span class="identifier">UntrustworthyData</span></a><span class="symbol">&lt;</span><span class="identifier">T</span><span class="symbol">&gt;</span></code></td>
</tr>
<tr>
<td>
<a href="../../../com.r3corda.core.protocols/-protocol-logic/sub-protocol.html">subProtocol</a></td>
<td>
<code><span class="keyword">fun </span><span class="symbol">&lt;</span><span class="identifier">R</span><span class="symbol">&gt;</span> <span class="identifier">subProtocol</span><span class="symbol">(</span><span class="identifier" id="com.r3corda.core.protocols.ProtocolLogic$subProtocol(com.r3corda.core.protocols.ProtocolLogic((com.r3corda.core.protocols.ProtocolLogic.subProtocol.R)))/subLogic">subLogic</span><span class="symbol">:</span>&nbsp;<a href="../../../com.r3corda.core.protocols/-protocol-logic/index.html"><span class="identifier">ProtocolLogic</span></a><span class="symbol">&lt;</span><span class="identifier">R</span><span class="symbol">&gt;</span><span class="symbol">)</span><span class="symbol">: </span><span class="identifier">R</span></code><p>Invokes the given subprotocol by simply passing through this <a href="../../../com.r3corda.core.protocols/-protocol-logic/index.html">ProtocolLogic</a>s reference to the
<a href="../../../com.r3corda.core.protocols/-protocol-state-machine/index.html">ProtocolStateMachine</a> and then calling the <a href="../../../com.r3corda.core.protocols/-protocol-logic/call.html">call</a> method.</p>
</td>
</tr>
</tbody>
</table>
<h3>Inheritors</h3>
<table>
<tbody>
<tr>
<td>
<a href="../../-validating-notary-protocol/index.html">ValidatingNotaryProtocol</a></td>
<td>
<code><span class="keyword">class </span><span class="identifier">ValidatingNotaryProtocol</span>&nbsp;<span class="symbol">:</span>&nbsp;<span class="identifier">Service</span></code><p>A notary commit protocol that makes sure a given transaction is valid before committing it. This does mean that the calling
party has to reveal the whole transaction history; however, we avoid complex conflict resolution logic where a party
has its input states "blocked" by a transaction from another party, and needs to establish whether that transaction was
indeed valid.</p>
</td>
</tr>
</tbody>
</table>
</BODY>
</HTML>
